
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Fake Algoan Website</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .button-group {
        text-align: center;
        margin-top: 50px;
      }
      .redirect-button {
        cursor: pointer;
        padding: 20px;
        border: none;
        outline: none;
        background: #003d4b;
        font-weight: bold;
        color: white;
        font-size: 16px;
        display: block;
        margin: auto;
        margin-bottom: 30px;
        width: 290px;
        max-width: 90%;
      }
      html, body {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="button-group">
      <button class="redirect-button" id="bi-redirection" onclick="onButtonClick()">Launch BI redirection process</button>
      <button class="redirect-button" id="redirect-to-bi" onclick="redirectUser()">Redirect to BI</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script>
      function onButtonClick() {
        /**
         * Create a new banks user
         */
        return axios.post('{{ algoanBaseUrl }}' + '/v1/banks-users', {
          callbackUrl: '{{ callbackUrl }}',
        }, {
          headers: {
            'Authorization': '{{token}}',
          }
        })
        .then(function(response) {
          const payload = {
            banksUserId: response.data.id,
          };
          return axios.post('{{ baseUrl }}' + '/hooks', {
            payload,
            subscription: {
              id: '{{ subscription.id }}',
              target: '{{ subscription.target }}',
              eventName: '{{ subscription.eventName }}',
              status: '{{ subscription.status }}'
            },
            time: Date.now(),
            index: Math.floor(Math.random() * 100),
            id: makeid(12),
          }, {
            headers: {
              'x-hub-signature': CryptoJS.HmacSHA256(JSON.stringify(payload), '{{ subscription.secret }}').toString()
            }
          });
        });
      }

      function redirectUser() {
        window.location.href = '{{ redirectUrl }}'
      }

      function makeid(length) {
        let result = '';
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        const charactersLength = characters.length;
        for ( var i = 0; i < length; i++ ) {
          result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return result;
      }
    </script>
  </body>
</html>